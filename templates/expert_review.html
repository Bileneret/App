{% extends "base.html" %}
{% block title %}–†–æ–∑–≥–ª—è–¥ –∑–∞—è–≤–∫–∏ ‚Ññ{{ application.id }}{% endblock %}

{% block content %}
<h1>–†–æ–∑–≥–ª—è–¥ –∑–∞—è–≤–∫–∏ ‚Ññ{{ application.id }}</h1>

<div style="background: var(--bg-body); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
    <h3>{{ application.title }}</h3>
    <p style="white-space: pre-wrap;">{{ application.short_description }}</p>
    <p><small>–ê–≤—Ç–æ—Ä: {{ application.owner.email }}</small></p>
</div>

{% if application.files %}
    <h3 style="margin-top: 30px;">–ü—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏</h3>
    <div class="file-gallery">
        {% for f in application.files %}
            {% set ext = f.filename.split('.')[-1].lower() %}
            <div class="file-card">
                <div class="file-preview">
                    {% if ext in ['png', 'jpg', 'jpeg', 'gif'] %}
                        <img src="{{ url_for('download_file', filename=f.filename) }}" alt="Preview">
                    {% else %}
                        <div class="file-icon">üìÑ</div>
                    {% endif %}
                </div>

                <div class="file-info">
                    <span class="file-name" title="{{ f.filename }}">{{ f.filename }}</span>
                    <div class="file-actions">
                        <button type="button" class="icon-btn" onclick="openPreview('{{ url_for('download_file', filename=f.filename) }}', '{{ ext }}')" title="–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </button>
                        <a href="{{ url_for('download_file', filename=f.filename) }}" class="icon-btn" title="–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏" download>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M12 9.75l-3 3m0 0l3 3m-3-3l-3 3M12 9.75V3" />
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}

<hr>

<h3>–ü—Ä–∏–π–Ω—è—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è</h3>
<form method="post">
    <label for="decision">–°—Ç–∞—Ç—É—Å:</label>
    <select name="decision" id="decision" required>
        <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å —Ä—ñ—à–µ–Ω–Ω—è...</option>
        <option value="approved">–°—Ö–≤–∞–ª–∏—Ç–∏ (Approved)</option>
        <option value="needs_changes">–ù–∞ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è (Needs Changes)</option>
        <option value="rejected">–í—ñ–¥—Ö–∏–ª–∏—Ç–∏ (Rejected)</option>
    </select>

    <label for="comment">–ö–æ–º–µ–Ω—Ç–∞—Ä –µ–∫—Å–ø–µ—Ä—Ç–∞ (–æ–±–æ–≤'—è–∑–∫–æ–≤–æ –¥–ª—è –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è/–¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è):</label>
    <textarea name="comment" id="comment" rows="5" placeholder="–í–∫–∞–∂—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É –∞–±–æ –∑–∞—É–≤–∞–∂–µ–Ω–Ω—è..."></textarea>

    <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è</button>
</form>

<p>
    <a href="{{ url_for('expert_dashboard') }}">–ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É</a>
</p>

<div id="previewModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div id="modalBody"></div>
    </div>
</div>

<script>
    var modal = document.getElementById("previewModal");
    var modalBody = document.getElementById("modalBody");

    function openPreview(url, ext) {
        modal.style.display = "block";
        modalBody.innerHTML = "";

        if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
            var img = document.createElement("img");
            img.src = url;
            img.style.maxWidth = "100%";
            img.style.maxHeight = "80vh";
            modalBody.appendChild(img);
        } else if (['pdf', 'txt'].includes(ext)) {
            var iframe = document.createElement("iframe");
            iframe.src = url;
            iframe.style.width = "100%";
            iframe.style.height = "80vh";
            iframe.style.border = "none";
            modalBody.appendChild(iframe);
        } else {
            modalBody.innerHTML = "<p style='color:white; text-align:center; padding: 50px;'>–ü–µ—Ä–µ–≥–ª—è–¥ —Ü—å–æ–≥–æ —Ç–∏–ø—É —Ñ–∞–π–ª—É –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è.<br>–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –π–æ–≥–æ.</p>";
        }
    }

    function closeModal() {
        modal.style.display = "none";
        modalBody.innerHTML = "";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            closeModal();
        }
    }
</script>
{% endblock %}