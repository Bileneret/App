{% extends "base.html" %}
{% block title %}Заявка №{{ application.id }}{% endblock %}

{% block content %}
<h1>Заявка №{{ application.id }}</h1>

<div style="margin-bottom: 20px;">
    <p><strong>Назва:</strong> {{ application.title }}</p>
    <div style="margin: 10px 0; display: flex; align-items: center; gap: 10px;">
        <strong>Статус:</strong>

        {% if application.status == 'draft' %}
            <span class="status-badge status-draft">Чорнетка</span>
        {% elif application.status == 'submitted' %}
            <span class="status-badge status-submitted">На розгляді</span>
        {% elif application.status == 'needs_changes' %}
            <span class="status-badge status-needs-changes">Потребує змін</span>
        {% elif application.status == 'approved' %}
            <span class="status-badge status-approved">Схвалено</span>
        {% elif application.status == 'rejected' %}
            <span class="status-badge status-rejected">Відхилено</span>
        {% elif application.status == 'cancelled' %}
            <span class="status-badge status-cancelled">Скасовано</span>
        {% else %}
            {{ application.status }}
        {% endif %}
    </div>
    <p><strong>Створено:</strong> {{ application.created_at.strftime('%Y-%m-%d') }}</p>
</div>

{% if application.expert_comment %}
    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid var(--primary); padding: 15px; border-radius: 6px; margin-bottom: 20px;">
        <h3 style="color: var(--primary); margin-top: 0;">Коментар експерта:</h3>
        <p style="white-space: pre-wrap; margin-bottom: 0;">{{ application.expert_comment }}</p>
    </div>
{% endif %}

<h2>Опис</h2>
<p style="white-space: pre-wrap;">{{ application.short_description }}</p>

<hr>

{% if g.user.id == application.owner_id %}
    {% if application.status in ("draft", "needs_changes") %}
        <p>
            <a href="{{ url_for('edit_application', application_id=application.id) }}">Редагувати</a>
        </p>
        <form action="{{ url_for('submit_application', application_id=application.id) }}" method="post">
            <button type="submit">Подати на розгляд</button>
        </form>

    {% elif application.status == "submitted" %}
        <p>Заявку подано. Очікуйте рішення експерта.</p>
        <form action="{{ url_for('cancel_application', application_id=application.id) }}" method="post">
            <button type="submit" style="background:#b91c1c;">Скасувати заявку</button>
        </form>

    {% elif application.status == "approved" %}
        <p style="color: var(--text-muted);">Вітаємо! Вашу заявку схвалено.</p>

    {% endif %}
{% endif %}

<p>
    <a href="{{ url_for('my_applications') }}">Повернутися до списку</a>
</p>
{% endblock %}